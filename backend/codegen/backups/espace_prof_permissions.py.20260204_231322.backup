from rest_framework import permissions


# --- Enseignant ---
class CanViewEnseignant(permissions.BasePermission):
    """Lecture (GET) : is_staff ou permission view_enseignant."""
    def has_permission(self, request, view):
        if request.method in ("GET", "HEAD", "OPTIONS"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.view_enseignant")
            )
        return True


class CanCreateEnseignant(permissions.BasePermission):
    """Création (POST) : is_staff ou permission add_enseignant."""
    def has_permission(self, request, view):
        if request.method == "POST":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.add_enseignant")
            )
        return True


class CanUpdateEnseignant(permissions.BasePermission):
    """Modification (PUT, PATCH) : is_staff ou permission change_enseignant."""
    def has_permission(self, request, view):
        if request.method in ("PUT", "PATCH"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.change_enseignant")
            )
        return True


class CanDeleteEnseignant(permissions.BasePermission):
    """Suppression (DELETE) : is_staff ou permission delete_enseignant."""
    def has_permission(self, request, view):
        if request.method == "DELETE":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.delete_enseignant")
            )
        return True


# --- Cours ---
class CanViewCours(permissions.BasePermission):
    """Lecture (GET) : is_staff ou permission view_cours."""
    def has_permission(self, request, view):
        if request.method in ("GET", "HEAD", "OPTIONS"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.view_cours")
            )
        return True


class CanCreateCours(permissions.BasePermission):
    """Création (POST) : is_staff ou permission add_cours."""
    def has_permission(self, request, view):
        if request.method == "POST":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.add_cours")
            )
        return True


class CanUpdateCours(permissions.BasePermission):
    """Modification (PUT, PATCH) : is_staff ou permission change_cours."""
    def has_permission(self, request, view):
        if request.method in ("PUT", "PATCH"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.change_cours")
            )
        return True


class CanDeleteCours(permissions.BasePermission):
    """Suppression (DELETE) : is_staff ou permission delete_cours."""
    def has_permission(self, request, view):
        if request.method == "DELETE":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.delete_cours")
            )
        return True


# --- Chapitre ---
class CanViewChapitre(permissions.BasePermission):
    """Lecture (GET) : is_staff ou permission view_chapitre."""
    def has_permission(self, request, view):
        if request.method in ("GET", "HEAD", "OPTIONS"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.view_chapitre")
            )
        return True


class CanCreateChapitre(permissions.BasePermission):
    """Création (POST) : is_staff ou permission add_chapitre."""
    def has_permission(self, request, view):
        if request.method == "POST":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.add_chapitre")
            )
        return True


class CanUpdateChapitre(permissions.BasePermission):
    """Modification (PUT, PATCH) : is_staff ou permission change_chapitre."""
    def has_permission(self, request, view):
        if request.method in ("PUT", "PATCH"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.change_chapitre")
            )
        return True


class CanDeleteChapitre(permissions.BasePermission):
    """Suppression (DELETE) : is_staff ou permission delete_chapitre."""
    def has_permission(self, request, view):
        if request.method == "DELETE":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.delete_chapitre")
            )
        return True


# --- RessourceCours ---
class CanViewRessourceCours(permissions.BasePermission):
    """Lecture (GET) : is_staff ou permission view_ressourcecours."""
    def has_permission(self, request, view):
        if request.method in ("GET", "HEAD", "OPTIONS"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.view_ressourcecours")
            )
        return True


class CanCreateRessourceCours(permissions.BasePermission):
    """Création (POST) : is_staff ou permission add_ressourcecours."""
    def has_permission(self, request, view):
        if request.method == "POST":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.add_ressourcecours")
            )
        return True


class CanUpdateRessourceCours(permissions.BasePermission):
    """Modification (PUT, PATCH) : is_staff ou permission change_ressourcecours."""
    def has_permission(self, request, view):
        if request.method in ("PUT", "PATCH"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.change_ressourcecours")
            )
        return True


class CanDeleteRessourceCours(permissions.BasePermission):
    """Suppression (DELETE) : is_staff ou permission delete_ressourcecours."""
    def has_permission(self, request, view):
        if request.method == "DELETE":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.delete_ressourcecours")
            )
        return True


# --- Exercice ---
class CanViewExercice(permissions.BasePermission):
    """Lecture (GET) : is_staff ou permission view_exercice."""
    def has_permission(self, request, view):
        if request.method in ("GET", "HEAD", "OPTIONS"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.view_exercice")
            )
        return True


class CanCreateExercice(permissions.BasePermission):
    """Création (POST) : is_staff ou permission add_exercice."""
    def has_permission(self, request, view):
        if request.method == "POST":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.add_exercice")
            )
        return True


class CanUpdateExercice(permissions.BasePermission):
    """Modification (PUT, PATCH) : is_staff ou permission change_exercice."""
    def has_permission(self, request, view):
        if request.method in ("PUT", "PATCH"):
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.change_exercice")
            )
        return True


class CanDeleteExercice(permissions.BasePermission):
    """Suppression (DELETE) : is_staff ou permission delete_exercice."""
    def has_permission(self, request, view):
        if request.method == "DELETE":
            return request.user.is_authenticated and (
                request.user.is_staff or request.user.has_perm("espace_prof.delete_exercice")
            )
        return True
